GUI_VERSION = 1.0.3
RES_LANG = en
BASENAME = openvpn-gui-$(GUI_VERSION)-$(RES_LANG)
EXE = $(BASENAME).exe

CC = @CC@
WINDRES = @WINDRES@
ZIP = @ZIP@

CFLAGS = @CRYPTO_CPPFLAGS@ @CFLAGS@ @CPPFLAGS@
LDFLAGS = @CRYPTO_LDFLAGS@ @LDFLAGS@
LIBS = @CRYPTO_LIBS@ @LIBS@

CFLAGS += -W -Wall -Wfloat-equal -Wundef -Wshadow -Wpointer-arith -Wbad-function-cast \
          -Wcast-align -Wwrite-strings -Wconversion -Wsign-compare \
          -Waggregate-return -Wmissing-noreturn -Wmissing-format-attribute \
          -Wredundant-decls -Winline -Wdisabled-optimization \
          -Wno-unused-function -Wno-unused-variable 

OBJS = main.o tray.o openvpn.o openvpn_monitor_process.o viewlog.o \
       service.o options.o passphrase.o proxy.o ieproxy.o registry.o \
       openvpn_config.o scripts.o 

SOURCES = main.c main.h openvpn.c openvpn.h \
          openvpn_monitor_process.c openvpn_monitor_process.h \
          tray.c tray.h viewlog.c viewlog.h service.c service.h \
          options.c options.h passphrase.c passphrase.h proxy.c proxy.h \
          ieproxy.c ieproxy.h registry.c registry.h scripts.c scripts.h \
          openvpn_config.c openvpn_config.h \
          chartable.h openvpn-gui-res.h openvpn-gui-$(RES_LANG).rc

EXTRA = connected.ico connecting.ico disconnected.ico reconnecting.ico openvpn-gui.ico \
        acinclude.m4 Makefile.in aclocal.m4 config.h.in configure configure.ac \
        OpenVPN\ GUI\ ReadMe.txt changes.txt COPYING COPYRIGHT.GPL
   
all : ${OBJS} openvpn-gui-$(RES_LANG).res
	${CC} $(CFLAGS) $(LDFLAGS) -o ${EXE} ${OBJS} ${LIBS} 

%.o : %.c %.h
	$(CC) $(CFLAGS) -c $<

openvpn-gui-$(RES_LANG).res : openvpn-gui-$(RES_LANG).rc openvpn-gui-res.h
	$(WINDRES) -i openvpn-gui-$(RES_LANG).rc -I rc -o openvpn-gui-$(RES_LANG).res -O coff 

dist:
	@test -x "$(ZIP)" || { \
		echo "zip(1) was not found on your system"; \
		echo "please install and run configure again"; \
		exit 1; \
	}
	rm -rf $(BASENAME)
	mkdir $(BASENAME)
	cp $(SOURCES) $(EXTRA) $(BASENAME)
	$(ZIP) -qr $(BASENAME).zip $(BASENAME)
	rm -rf $(BASENAME)

clean :
	rm -f *.o *.exe *.res
